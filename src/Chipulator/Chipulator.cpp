#include <cstdlib>
#include <Chipulator/Chipulator.hpp>

void Chipulator::load_program(std::string fname)
{
	std::ifstream program_file(fname, std::ios::binary | std::ios::in);
	if(!program_file.is_open())
		return false;

	int i=0;

	while(program_file.good())
	{
		//Read file into memory
		byte &curr_byte = memory[memory_start+i];
		curr_byte = program_file.get();
		std::cout<<std::hex<<std::uppercase<<(int)curr_byte;
		if(i%2 == 1) std::cout<<" ";
		if(i%16 == 15) std::cout<<"\n";
		++i;
	}
	std::cout<<"\n";
	program_size = i;
}

void Chipulator::load_font()
{
	byte font[] =
	{0xF0,0x90,0x90,0x90,0xF0,
	 0x20,0x60,0x20,0x20,0x70,
	 0xF0,0x10,0xF0,0x80,0xF0,
	 0xF0,0x10,0xF0,0x10,0xF0,
	 0x90,0x90,0xF0,0x10,0x10,
	 0xF0,0x80,0xF0,0x10,0xF0,
	 0xF0,0x80,0xF0,0x90,0xF0,
	 0xF0,0x10,0x20,0x40,0x40,
	 0xF0,0x90,0xF0,0x90,0xF0,
	 0xF0,0x90,0xF0,0x10,0xF0,
	 0xF0,0x90,0xF0,0x90,0x90,
	 0xE0,0x90,0xE0,0x90,0xE0,
	 0xF0,0x80,0x80,0x80,0xF0,
	 0xE0,0x90,0x90,0x90,0xE0,
	 0xF0,0x80,0xF0,0x80,0xF0,
	 0xF0,0x80,0xF0,0x80,0x80};

	auto len = strlen(font)
	for(auto i = 0; i < len; ++i)
	{
		memory[font_pos+i] = font[i];
	}
}